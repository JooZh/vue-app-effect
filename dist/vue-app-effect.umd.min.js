/**
* vue-app-effect v1.0.2
* https://github.com/JooZh/vue-app-effect
* Released under the MIT License.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueAppEffect=e()}(this,function(){"use strict";var i=function(e,t){return{name:"vnode-cache",abstract:!0,props:{},data:function(){return{routerLen:0,route:{},to:{},from:{},tabBar:t,direction:"",paths:[]}},computed:{},watch:{route:function(t,e){var o=this;this.to=t,this.from=e,-1===this.tabBar.findIndex(function(t){return t===o.$route.fullPath})&&(this.paths.push(t.fullPath),this.paths=[].concat(function(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}(new Set(this.paths))))}},created:function(){var t=this;this.cache={},this.routerLen=this.$router.options.routes.length,this.route=this.$route,this.to=this.$route,e.$on("reverse",function(){t.direction="reverse",t.reverse()}),e.$on("forward",function(){t.direction="forward"})},destroyed:function(){for(var t in this.cache){var e=this.cache[t];e&&e.componentInstance.$destroy()}},methods:{reverse:function(){var e=this,o=this.paths.pop(),t=this.$router.options.routes,r=this.tabBar.findIndex(function(t){return t===e.$route.fullPath}),n=t.findIndex(function(t){return t.path===o});-1===r&&n>=this.routerLen&&(delete window.sessionStorage[o],window.sessionStorage.count-=1);var i=-1===r?this.$route.fullPath:"";this.cache[i]&&(this.cache[o].componentInstance.$destroy(),delete this.cache[o])}},render:function(){var e=this;this.route=this.$route;var t=this.$slots.default?this.$slots.default[0]:null;if(t){var o=-1===this.tabBar.findIndex(function(t){return t===e.$route.fullPath})?this.$route.fullPath:"/tab-bar";this.cache[o]?t.componentInstance=this.cache[o].componentInstance:this.cache[o]=t,t.data.keepAlive=!0}return t}}};return{install:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=e.router,a=e.store,c=e.tabbar,r=e.common,n=void 0===r?"":r;if(o&&a&&c){var u=new t;a.registerModule("NAV_DIRECTION",{state:{direction:"forward"},mutations:{NAV_DIRECTION_UPDATE:function(t,e){t.direction=e.direction}}}),window.addEventListener("load",function(){o.replace({path:"/"})}),window.sessionStorage.clear(),window.sessionStorage.setItem("count",0),window.sessionStorage.setItem("/",0),n&&window.sessionStorage.setItem(n,999999);var d=!1,h=Date.now();document.addEventListener("touchend",function(){h=Date.now()}),["push","go","replace","forward","back"].forEach(function(t){var r=o[t].bind(o);o[t]=function(){d=!0;for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];r.apply(null,e)}}),o.beforeEach(function(e,t,o){var r=Number(window.sessionStorage.getItem(e.path)),n=Number(window.sessionStorage.getItem(t.path));if(-1===c.findIndex(function(t){return t===e.path})){if(r)n<r?(u.$emit("forward","forward"),a.commit("NAV_DIRECTION_UPDATE",{direction:"forward"})):!d&&Date.now()-h<377?(u.$emit("reverse",""),a.commit("NAV_DIRECTION_UPDATE",{direction:""})):(u.$emit("reverse","reverse"),a.commit("NAV_DIRECTION_UPDATE",{direction:"reverse"}));else{var i=++window.sessionStorage.count;window.sessionStorage.setItem("count",i),window.sessionStorage.setItem(e.path,i),u.$emit("forward","forward"),a.commit("NAV_DIRECTION_UPDATE",{direction:"forward"})}if(/\/http/.test(e.path)){var s=e.path.split("http")[1];window.location.href="http"+s}else o()}else!d&&Date.now()-h<377?(u.$emit("reverse",""),a.commit("NAV_DIRECTION_UPDATE",{direction:""})):(u.$emit("reverse","reverse"),a.commit("NAV_DIRECTION_UPDATE",{direction:"reverse"})),o()}),o.afterEach(function(){d=!1}),t.component("vnode-cache",i(u,c)),t.direction=t.prototype.$direction={on:function(t,e){u.$on(t,e)}}}else console.error("vue-app-effect need options: router, tabbar and store")}}});