/**
* vue-app-effect v1.0.2
* https://github.com/JooZh/vue-app-effect
* Released under the MIT License.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueAppEffect=e()}(this,function(){"use strict";var a=function(e,t){return{name:"vnode-cache",abstract:!0,props:{},data:function(){return{routerLen:0,route:{},to:{},from:{},tabBar:t,paths:[]}},computed:{},watch:{route:function(t,e){var r=this;this.to=t,this.from=e,-1===this.tabBar.findIndex(function(t){return t===r.$route.fullPath})&&(this.paths.push(t.fullPath),this.paths=[].concat(function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}(new Set(this.paths))))}},created:function(){var t=this;this.cache={},this.routerLen=this.$router.options.routes.length,this.route=this.$route,this.to=this.$route,e.$on("reverse",function(){t.reverse()})},destroyed:function(){for(var t in this.cache){var e=this.cache[t];e&&e.componentInstance.$destroy()}},methods:{reverse:function(){var e=this,r=this.paths.pop(),t=this.$router.options.routes,n=this.tabBar.findIndex(function(t){return t===e.$route.fullPath}),o=t.findIndex(function(t){return t.path===r});-1===n&&o>=this.routerLen&&(delete window.NavStorage[r],window.NavStorage.count-=1);var a=-1===n?this.$route.fullPath:"";this.cache[a]&&(this.cache[r].componentInstance.$destroy(),delete this.cache[r])}},render:function(){var e=this;this.route=this.$route;var t=this.$slots.default?this.$slots.default[0]:null;if(t){var r=-1===this.tabBar.findIndex(function(t){return t===e.$route.fullPath})?this.$route.fullPath:"/tab-bar";this.cache[r]?t.componentInstance=this.cache[r].componentInstance:this.cache[r]=t,t.data.keepAlive=!0}return t}}};return{install:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=e.router,s=e.tabbar,n=e.common,o=void 0===n?"":n;if(r&&s){window.addEventListener("load",function(){r.replace({path:"/"})}),window.NavStorage={count:0,paths:[]},o&&(window.NavStorage[o]=9999999);var h=!1,u=Date.now();document.addEventListener("touchend",function(){u=Date.now()}),["push","go","replace","forward","back"].forEach(function(t){var n=r[t].bind(r);r[t]=function(){h=!0;for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];n.apply(null,e)}});var c=new t;r.beforeEach(function(e,r,t){if(/\/http/.test(e.path))window.location.href=e.path;else{var n=Number(window.NavStorage[e.path]),o=Number(window.NavStorage[r.path]);o=o||0;var a=s.findIndex(function(t){return t===e.path});s.findIndex(function(t){return t===r.path});if(-1===a)if(0<n)o<n?(c.$emit("forward",{type:"forward",isTab:!1}),window.NavStorage.paths.push(e.path)):!h&&Date.now()-u<377?c.$emit("reverse",{type:"",isTab:!1}):c.$emit("reverse",{type:"reverse",isTab:!1});else{var i=++window.NavStorage.count;window.NavStorage.count=i,window.NavStorage[e.path]=i,c.$emit("forward",{type:"forward",isTab:!1}),window.NavStorage.paths.push(e.path)}else window.NavStorage.paths.pop(),!h&&Date.now()-u<377?c.$emit("reverse",{type:"",isTab:!0}):c.$emit("reverse",{type:"reverse",isTab:!0}),window.NavStorage.paths.push(e.path);t()}}),r.afterEach(function(){h=!1}),t.component("vnode-cache",a(c,s)),t.direction=t.prototype.$direction={on:function(t,e){c.$on(t,e)}}}else console.error("vue-app-effect need options: router, tabbar")}}});