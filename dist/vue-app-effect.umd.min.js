/**
* vue-app-effect v1.0.2
* https://github.com/JooZh/vue-app-effect
* Released under the MIT License.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueAppEffect=e()}(this,function(){"use strict";var i=function(e,t){return{name:"vnode-cache",abstract:!0,props:{},data:function(){return{routerLen:0,route:{},to:{},from:{},tabBar:t,direction:"",paths:[]}},computed:{},watch:{route:function(t,e){var r=this;this.to=t,this.from=e,-1===this.tabBar.findIndex(function(t){return t===r.$route.fullPath})&&(this.paths.push(t.fullPath),this.paths=[].concat(function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}(new Set(this.paths))))}},created:function(){var t=this;this.cache={},this.routerLen=this.$router.options.routes.length,this.route=this.$route,this.to=this.$route,e.$on("reverse",function(){t.direction="reverse",t.reverse()}),e.$on("forward",function(){t.direction="forward"})},destroyed:function(){for(var t in this.cache){var e=this.cache[t];e&&e.componentInstance.$destroy()}},methods:{reverse:function(){var e=this,r=this.paths.pop(),t=this.$router.options.routes,o=this.tabBar.findIndex(function(t){return t===e.$route.fullPath}),n=t.findIndex(function(t){return t.path===r});-1===o&&n>=this.routerLen&&(delete window.sessionStorage[r],window.sessionStorage.count-=1);var i=-1===o?this.$route.fullPath:"";this.cache[i]&&(this.cache[r].componentInstance.$destroy(),delete this.cache[r])}},render:function(){var e=this;this.route=this.$route;var t=this.$slots.default?this.$slots.default[0]:null;if(t){var r=-1===this.tabBar.findIndex(function(t){return t===e.$route.fullPath})?this.$route.fullPath:"/tab-bar";this.cache[r]?t.componentInstance=this.cache[r].componentInstance:this.cache[r]=t,t.data.keepAlive=!0}return t}}};return{install:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=e.router,u=e.store,d=e.tabbar,o=e.common,n=void 0===o?"":o;if(r&&u&&d){var h=new t;u.registerModule("NAV_DIRECTION",{state:{direction:"forward"},mutations:{NAV_DIRECTION_UPDATE:function(t,e){t.direction=e.direction}}}),window.addEventListener("load",function(){r.replace({path:"/"})}),window.sessionStorage.clear(),window.sessionStorage.setItem("count",0),window.sessionStorage.setItem("/",0),n&&window.sessionStorage.setItem(n,999999);var f=!1,p=Date.now();document.addEventListener("touchend",function(){p=Date.now()}),["push","go","replace","forward","back"].forEach(function(t){var o=r[t].bind(r);r[t]=function(){f=!0;for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];o.apply(null,e)}}),r.beforeEach(function(e,r,t){var o=Number(window.sessionStorage.getItem(e.path)),n=Number(window.sessionStorage.getItem(r.path)),i=d.findIndex(function(t){return t===e.path}),s=d.findIndex(function(t){return t===r.path});if(-1===i){if(0<o)n<o?(h.$emit("forward",{type:"forward",isTab:!1}),u.commit("NAV_DIRECTION_UPDATE",{direction:"forward"})):!f&&Date.now()-p<377?(h.$emit("reverse",{type:"",isTab:!1}),u.commit("NAV_DIRECTION_UPDATE",{direction:""})):(h.$emit("reverse",{type:"reverse",isTab:!1}),u.commit("NAV_DIRECTION_UPDATE",{direction:"reverse"}));else{var a=++window.sessionStorage.count;window.sessionStorage.setItem("count",a),window.sessionStorage.setItem(e.path,a),h.$emit("forward",{type:"forward",isTab:!1}),u.commit("NAV_DIRECTION_UPDATE",{direction:"forward"})}if(/\/http/.test(e.path)){var c=e.path.split("http")[1];window.location.href="http"+c}else t()}else if(!f&&Date.now()-p<377){if(-1!==s)return;h.$emit("reverse",{type:"",isTab:!0}),u.commit("NAV_DIRECTION_UPDATE",{direction:""}),t()}else h.$emit("reverse",{type:"reverse",isTab:!0}),u.commit("NAV_DIRECTION_UPDATE",{direction:"reverse"}),t()}),r.afterEach(function(){f=!1}),t.component("vnode-cache",i(h,d)),t.direction=t.prototype.$direction={on:function(t,e){h.$on(t,e)}}}else console.error("vue-app-effect need options: router, tabbar and store")}}});