/**
* vue-app-effect v1.0.2
* https://github.com/JooZh/vue-app-effect
* Released under the MIT License.
*/
function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}var VnodeCache=function(t,e){return{name:"vnode-cache",abstract:!0,props:{},data:function(){return{routerLen:0,route:{},to:{},from:{},tabBar:e,paths:[]}},computed:{},watch:{route:function(t,e){var r=this;this.to=t,this.from=e,-1===this.tabBar.findIndex(function(t){return t===r.$route.fullPath})&&(this.paths.push(t.fullPath),this.paths=[].concat(_toConsumableArray(new Set(this.paths))))}},created:function(){var e=this;this.cache={},this.routerLen=this.$router.options.routes.length,this.route=this.$route,this.to=this.$route,t.$on("reverse",function(){e.reverse()})},destroyed:function(){for(var t in this.cache){var e=this.cache[t];e&&e.componentInstance.$destroy()}},methods:{reverse:function(){var t=this,e=this.paths.pop(),r=this.$router.options.routes,a=this.tabBar.findIndex(function(e){return e===t.$route.fullPath}),n=r.findIndex(function(t){return t.path===e});-1===a&&n>=this.routerLen&&(delete window.NavStorage[e],window.NavStorage.count-=1);var o=-1===a?this.$route.fullPath:"";this.cache[o]&&(this.cache[e].componentInstance.$destroy(),delete this.cache[e])}},render:function(){var t=this;this.route=this.$route;var e=this.$slots.default?this.$slots.default[0]:null;if(e){var r=-1===this.tabBar.findIndex(function(e){return e===t.$route.fullPath})?this.$route.fullPath:"/tab-bar";this.cache[r]?e.componentInstance=this.cache[r].componentInstance:this.cache[r]=e,e.data.keepAlive=!0}return e}}},index={install:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.router,a=e.tabbar,n=e.common,o=void 0===n?"":n;if(r&&a){window.addEventListener("load",function(){r.replace({path:"/"})}),window.NavStorage={count:0,paths:[]},o&&(window.NavStorage[o]=9999999);var i=!1,s=Date.now();document.addEventListener("touchend",function(){s=Date.now()}),["push","go","replace","forward","back"].forEach(function(t){var e=r[t].bind(r);r[t]=function(){i=!0;for(var t=arguments.length,r=Array(t),a=0;a<t;a++)r[a]=arguments[a];e.apply(null,r)}});var h=new t;r.beforeEach(function(t,e,r){if(/\/http/.test(t.path))window.location.href=t.path;else{var n=Number(window.NavStorage[t.path]),o=Number(window.NavStorage[e.path]);o=o||0;var u=a.findIndex(function(e){return e===t.path});a.findIndex(function(t){return t===e.path});if(-1===u)if(n>0)n>o?(h.$emit("forward",{type:"forward",isTab:!1}),window.NavStorage.paths.push(t.path)):!i&&Date.now()-s<377?h.$emit("reverse",{type:"",isTab:!1}):h.$emit("reverse",{type:"reverse",isTab:!1});else{var c=++window.NavStorage.count;window.NavStorage.count=c,window.NavStorage[t.path]=c,h.$emit("forward",{type:"forward",isTab:!1}),window.NavStorage.paths.push(t.path)}else window.NavStorage.paths.pop(),!i&&Date.now()-s<377?h.$emit("reverse",{type:"",isTab:!0}):h.$emit("reverse",{type:"reverse",isTab:!0}),window.NavStorage.paths.push(t.path);r()}}),r.afterEach(function(){i=!1}),t.component("vnode-cache",VnodeCache(h,a)),t.direction=t.prototype.$direction={on:function(t,e){h.$on(t,e)}}}else console.error("vue-app-effect need options: router, tabbar")}};export default index;