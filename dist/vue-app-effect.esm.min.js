/**
* vue-app-effect v1.0.2
* https://github.com/JooZh/vue-app-effect
* Released under the MIT License.
*/
function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}var VnodeCache=function(t,e){return{name:"vnode-cache",abstract:!0,props:{},data:function(){return{routerLen:0,route:{},to:{},from:{},tabBar:e,direction:"",paths:[]}},computed:{},watch:{route:function(t,e){var r=this;this.to=t,this.from=e,-1===this.tabBar.findIndex(function(t){return t===r.$route.fullPath})&&(this.paths.push(t.fullPath),this.paths=[].concat(_toConsumableArray(new Set(this.paths))))}},created:function(){var e=this;this.cache={},this.routerLen=this.$router.options.routes.length,this.route=this.$route,this.to=this.$route,t.$on("reverse",function(){e.direction="reverse",e.reverse()}),t.$on("forward",function(){e.direction="forward"})},destroyed:function(){for(var t in this.cache){var e=this.cache[t];e&&e.componentInstance.$destroy()}},methods:{reverse:function(){var t=this,e=this.paths.pop(),r=this.$router.options.routes,o=this.tabBar.findIndex(function(e){return e===t.$route.fullPath}),n=r.findIndex(function(t){return t.path===e});-1===o&&n>=this.routerLen&&(delete window.sessionStorage[e],window.sessionStorage.count-=1);var i=-1===o?this.$route.fullPath:"";this.cache[i]&&(this.cache[e].componentInstance.$destroy(),delete this.cache[e])}},render:function(){var t=this;this.route=this.$route;var e=this.$slots.default?this.$slots.default[0]:null;if(e){var r=-1===this.tabBar.findIndex(function(e){return e===t.$route.fullPath})?this.$route.fullPath:"/tab-bar";this.cache[r]?e.componentInstance=this.cache[r].componentInstance:this.cache[r]=e,e.data.keepAlive=!0}return e}}},index={install:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.router,o=e.store,n=e.tabbar,i=e.common,a=void 0===i?"":i;if(r&&o&&n){var s=new t;o.registerModule("NAV_DIRECTION",{state:{direction:"forward"},mutations:{NAV_DIRECTION_UPDATE:function(t,e){t.direction=e.direction}}}),window.addEventListener("load",function(){r.replace({path:"/"})}),window.sessionStorage.clear(),window.sessionStorage.setItem("count",0),window.sessionStorage.setItem("/",0),a&&window.sessionStorage.setItem(a,999999);var c=!1,h=Date.now();document.addEventListener("touchend",function(){h=Date.now()}),["push","go","replace","forward","back"].forEach(function(t){var e=r[t].bind(r);r[t]=function(){c=!0;for(var t=arguments.length,r=Array(t),o=0;o<t;o++)r[o]=arguments[o];e.apply(null,r)}}),r.beforeEach(function(t,e,r){var i=Number(window.sessionStorage.getItem(t.path)),a=Number(window.sessionStorage.getItem(e.path)),u=n.findIndex(function(e){return e===t.path}),d=n.findIndex(function(t){return t===e.path});if(-1===u){if(i>0)i>a?(s.$emit("forward",{type:"forward",isTab:!1}),o.commit("NAV_DIRECTION_UPDATE",{direction:"forward"})):!c&&Date.now()-h<377?(s.$emit("reverse",{type:"",isTab:!1}),o.commit("NAV_DIRECTION_UPDATE",{direction:""})):(s.$emit("reverse",{type:"reverse",isTab:!1}),o.commit("NAV_DIRECTION_UPDATE",{direction:"reverse"}));else{var f=++window.sessionStorage.count;window.sessionStorage.setItem("count",f),window.sessionStorage.setItem(t.path,f),s.$emit("forward",{type:"forward",isTab:!1}),o.commit("NAV_DIRECTION_UPDATE",{direction:"forward"})}if(/\/http/.test(t.path)){var p=t.path.split("http")[1];window.location.href="http"+p}else r()}else if(!c&&Date.now()-h<377){if(-1!==d)return;s.$emit("reverse",{type:"",isTab:!0}),o.commit("NAV_DIRECTION_UPDATE",{direction:""}),r()}else s.$emit("reverse",{type:"reverse",isTab:!0}),o.commit("NAV_DIRECTION_UPDATE",{direction:"reverse"}),r()}),r.afterEach(function(){c=!1}),t.component("vnode-cache",VnodeCache(s,n)),t.direction=t.prototype.$direction={on:function(t,e){s.$on(t,e)}}}else console.error("vue-app-effect need options: router, tabbar and store")}};export default index;